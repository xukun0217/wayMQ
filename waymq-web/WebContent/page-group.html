<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>微麦可#活动终结者</title>

<link href="./css/bootstrap.css" rel="stylesheet">
<link href="./css/signin.css" rel="stylesheet">

<script type="text/javascript" src="./js/jquery.js"></script>
<script type="text/javascript" src="./js/waymq.js"></script>
<script type="text/javascript">
	function setupButtonHandler() {

		$("#button_create_event").click(function() {

			createEvent();

		});

		$("#link_detail_show_settings").click(showSettings);
		$("#button_settings_cancel").click(showDetail);
		$("#button_settings_ok").click(doSettingsOk);

	}

	function showView(id) {

		$("#view_group_detail").hide();
		$("#view_group_settings").hide();
		$("#view_create_event").hide();

		$(id).show();

	}

	function showSettings() {
		showView("#view_group_settings");
	}
	function showDetail() {
		showView("#view_group_detail");
	}

	function doSettingsOk() {

		var title = $("#edit_settings_title").val();
		var description = $("#edit_settings_description").val();

		var id = getURLQueryParameter(document.URL, "id");
		var url = new URLBuilder("Group", "setInfo");
		url["id"] = id;
		url["title"] = title;
		url["description"] = description;

		$.getJSON(url.toString(), function(json) {
			if (json.success) {
				alert("设置成功!");
				loadGroupInfo();
				showDetail();
			} else {
				var str = JSON.stringify(json);
				alert(str);
			}
		});

	}

	function loadGroupInfo() {

		var id = getURLQueryParameter(document.URL, "id");
		var url = new URLBuilder("Group", "getInfo");
		url.id = id;
		$.getJSON(url.toString(), function(json, status, xhr) {

			//			var str = JSON.stringify(json);
			//		alert(str);

			$("#info_name").text(json.name);
			$("#info_title").text(json.title);
			$("#info_description").text(json.description);

		});

	}

	function checkGroupExists() {

		var id = getURLQueryParameter(document.URL, "id");
		var url = new URLBuilder("Group", "exists");
		url.id = id;
		$.getJSON(url.toString(), function(json, status, xhr) {

			//	var str = JSON.stringify(json);
			//	alert(str);

			if (json.success) {
				if (!json.exists) {
					// goto 404
					window.location = "http404.html";
				}
			}

			//		window.location = "http404.html";

		});

	}

	function createEvent() {

		var title = $("#edit_title").val();
		var time = $("#edit_time").val();
		var content = $("#edit_content").val();

		var url = "do?class=WAYMQ";
		url = url + "&do=" + "newEvent";
		url = url + "&title=" + title;
		url = url + "&time=" + time;
		url = url + "&content=" + content;

		$.getJSON(url, function(data) {
			var str = JSON.stringify(data);
			alert(str);
		});

	}

	$(document).ready(function() {

		setupButtonHandler();
		loadGroupInfo();
		checkGroupExists();

		showView("#view_group_detail");

	});
</script>

</head>
<body>

	<div>微麦可#活动终结者::group</div>


	<div class="container">


		<form class="form-signin" role="form">




			<!-- overview  info -->
			<div id="view_group_overview">

				<div>
					<span id="info_title"></span> (<span id="info_name"></span>)
				</div>

			</div>

			<!-- detail  info -->
			<div id="view_group_detail">

				<a id="link_detail_show_settings" href="#">设置</a>

				<div id="info_description"></div>
			</div>



			<!-- settings -->
			<div id="view_group_settings">


				<h2 class="form-signin-heading">小组设置</h2>

				<!-- title -->
				<label>兴趣组名称</label> <input id="edit_settings_title" type="text"
					class="form-control" placeholder="兴趣组名称" value="aaa" required
					autofocus>

				<!-- description -->
				<label> 描述 </label> <input id="edit_settings_description"
					type="text" class="form-control" placeholder="描述" value="bbb"
					required>


				<!-- button -->
				<div>
					<a id="button_settings_cancel" href="#"
						class="btn btn-lg btn-primary btn-block">取消</a>
				</div>
				<div>
					<a id="button_settings_ok" href="#"
						class="btn btn-lg btn-primary btn-block">确定</a>
				</div>
			</div>


			<!-- new event -->
			<div id="view_create_event">

				<h2 class="form-signin-heading">创建活动</h2>

				<!-- title -->
				<input id="edit_title" type="text" class="form-control"
					placeholder="标题" value="aaa" required autofocus>
				<!-- time -->
				<input id="edit_time" type="text" class="form-control"
					placeholder="时间" value="bbb" required>
				<!-- content -->
				<input id="edit_content" type="text" class="form-control"
					placeholder="内容" value="ccc" required> <br /> <br />

				<!-- button -->
				<a id="button_create_event" href="#"
					class="btn btn-lg btn-primary btn-block">创建</a>

			</div>
		</form>

	</div>



</body>
</html>